- name: Hardening SSH configuration
  ansible.builtin.copy:
    dest: /etc/ssh/sshd_config.d/99-ansible-hardening.conf
    content: |
      PermitRootLogin no
      PasswordAuthentication no
      PubkeyAuthentication yes
      KbdInteractiveAuthentication no
      ChallengeResponseAuthentication no
    mode: '0644'
    owner: root
    group: root
    validate: /usr/sbin/sshd -t -f %s
  notify: Restart SSH